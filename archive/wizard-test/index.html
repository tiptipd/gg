<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/smartwizard@5/dist/css/smart_wizard_all.min.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" type="text/css" />
    <link href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css" rel="stylesheet" type="text/css" />
    <link href="./stepper.min.css" rel="stylesheet" />
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css' />

    <title>Wizard Test</title>
  </head>
  <body>
    <select id="theme_selector" class="form-control">
        <option value="default" selected="">Default</option>
        <option value="arrows">Arrows</option>
        <option value="dots">Dots</option>
        <option value="progress">Progress</option>
    </select>
    </button>
        <button id="jquery-add-step" class="mdl-button mdl-js-button mdl-js-ripple-effect">
    Add Step
    </button>
    </button>
        <button id="jquery-next-step" class="mdl-button mdl-js-button mdl-js-ripple-effect">
    Next Step
    </button>
    </button>
        <button id="jquery-prev-step" class="mdl-button mdl-js-button mdl-js-ripple-effect">
    Prev Step
    </button>
    </button>
        <button id="jquery-goto-step" class="mdl-button mdl-js-button mdl-js-ripple-effect">
    Go To Step
    </button>
    </button>
        <button id="jquery-reset-step" class="mdl-button mdl-js-button mdl-js-ripple-effect">
    Reset
    </button>
    </button>
        <button id="jquery-enable-step" class="mdl-button mdl-js-button mdl-js-ripple-effect">
    Enable Step
    </button>
    <div id="smartwizard">

        <ul id="smartwizard-list" class="nav">
            <li class="nav-item">
              <a class="nav-link" href="#step-1">
                Step 1
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#step-2">
                Step 2
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#step-3">
                Step 3
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#step-4">
                Step 4
              </a>
            </li>
        </ul>
    
        <div id="smartwizard-content" class="tab-content">
            <div id="step-1" class="tab-pane" role="tabpanel" aria-labelledby="step-1">
                Step 1 Content
            </div>
            <div id="step-2" class="tab-pane" role="tabpanel" aria-labelledby="step-2">
                Step 2 Content
            </div>
            <div id="step-3" class="tab-pane" role="tabpanel" aria-labelledby="step-3">
                Step 3 Content
            </div>
            <div id="step-4" class="tab-pane" role="tabpanel" aria-labelledby="step-4">
                Step 4 Content
            </div>
        </div>
    </div>
    <section class="mdl-stepper-demo">
        </button>
            <button id="mdl-add-step" class="mdl-button mdl-js-button mdl-js-ripple-effect">
            Add Step
        </button>
        <div class="mdl-grid">
          <div class="mdl-cell mdl-cell--12-col">
            <!-- markup -->
            <ul class="mdl-stepper" id="demo-stepper">
              <li class="mdl-step">
                <span class="mdl-step__label">
                  <span class="mdl-step__title">
                    <span class="mdl-step__title-text">Title of step 1</span>
                  </span>
                </span>
                <div class="mdl-step__content">
                </div>
                <div class="mdl-step__actions">
                  <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" data-stepper-next>
                    Continue
                  </button>
                  <button class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-cancel>
                    Cancel
                  </button>
                  <button disabled class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-back>
                    Back
                  </button>
                </div>
              </li>
              <li class="mdl-step">
                <span class="mdl-step__label">
              <span class="mdl-step__title">
                <span class="mdl-step__title-text">Title longer than it should be</span>
                </span>
                </span>
                <div class="mdl-step__content">
                  <form action="#">
                    <div class="mdl-textfield mdl-js-textfield">
                      <input autocomplete="off" class="mdl-textfield__input" type="text" id="stepper-transient-message">
                      <label class="mdl-textfield__label" for="stepper-transient-message">Transient message for current step</label>
                      <span class="mdl-textfield__error">Invalid input</span>
                    </div>
                  </form>
    
                </div>
                <div class="mdl-step__actions">
                  <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" data-stepper-next>
                Continue
              </button>
                  <button class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-cancel>
                Cancel
              </button>
                  <button disabled class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-back>
                Back
              </button>
                </div>
              </li>
              <li class="mdl-step">
                <span class="mdl-step__label">
              <span class="mdl-step__title">
                <span class="mdl-step__title-text">Title of step 3</span>
                </span>
                </span>
                <div class="mdl-step__content"></div>
                <div class="mdl-step__actions">
                  <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" data-stepper-next>
                Continue
              </button>
                  <button class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-cancel>
                Cancel
              </button>
                  <button disabled class="mdl-button mdl-js-button mdl-js-ripple-effect" data-stepper-back>
                Back
              </button>
                </div>
              </li>
            </ul>
    
          </div>
        </div>
    
      </section>
    
    <!-- JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" type="text/javascript"></script>
    <script src="./jquery.smartWizard.js" type="text/javascript"></script>
    <script src="https://code.getmdl.io/1.2.1/material.js" type="text/javascript"></script>
    <script src="./stepper.js" type="text/javascript"></script>
    <script type="text/javascript">
        var smartwizardItemCount = 4;
        var mdlWizardItemCount = 3;

        $(document).ready(function() {

            $('#smartwizard').smartWizard({
                darkMode: false
            });

        });

        function handleNextStep(e) {
            document.getElementById("demo-stepper").MaterialStepper.next();
        }

        $(window).on('load', function (e) {
        
            var selector = '.mdl-stepper';
            // Select stepper container element      
            var stepperElement = document.querySelector(selector);
            var Stepper;
            var steps;
            var inputTransientMessage /** @type {HTMLElement} */;

            if (!stepperElement) return;
            
            // Get the MaterialStepper instance of element to control it.          
            Stepper = stepperElement.MaterialStepper;
            
            if (!Stepper) {
                console.error('MaterialStepper instance is not available for selector: ' + selector + '.');
                return;
            }
            steps = stepperElement.querySelectorAll('.mdl-step');

            for (var i = 0; i < steps.length; i++) {
                
                // When user clicks on [data-stepper-next] button of step.          
                steps[i].addEventListener('onstepnext', handleNextStep);
            }
            // When all steps are completed this event is dispatched.          
            // stepperElement.addEventListener('onsteppercomplete', function (e) {
            //     var toast = document.querySelector('#snackbar-stepper-complete');
            //     if (!toast) return;
            //     toast.MaterialSnackbar.showSnackbar({
            //     message: 'Stepper horizontal + feedback are completed',
            //     timeout: 4000,
            //     actionText: 'Ok'
            //     });
            // });
        });

        $("#theme_selector").on("change", function() {
            // Change theme
            var options = {
                theme: $(this).val(),
                cycleSteps: false
            };
            $('#smartwizard').smartWizard("setOptions", options);
            return true;
        });

        $("#jquery-add-step").on("click", function() {
            smartwizardItemCount += 1;
            stepTitle = '<li class="nav-item"><a class="nav-link" href="#step-'+smartwizardItemCount.toString()+'">Step '+smartwizardItemCount.toString()+'</a></li>';
            stepContent = '<div id="step-'+smartwizardItemCount.toString()+'" class="tab-pane" role="tabpanel" aria-labelledby="step-'+smartwizardItemCount.toString()+'">Step '+smartwizardItemCount.toString()+' Content</div>';
            
            let nav = $('#smartwizard').smartWizard("getTabNav");
            let container = $('#smartwizard').smartWizard("getContentContainer");
            nav.append(stepTitle);
            container.append(stepContent);
            $('#smartwizard').smartWizard("refresh");
        });

        $("#jquery-next-step").on("click", function() {
            $('#smartwizard').smartWizard("next");
        });

        $("#jquery-prev-step").on("click", function() {
            $('#smartwizard').smartWizard("prev");
        });

        $("#jquery-goto-step").on("click", function() {
            $('#smartwizard').smartWizard("goToStep", 5);
        });

        $("#jquery-reset-step").on("click", function() {
            $('#smartwizard').smartWizard("reset");
        });

        $("#jquery-enable-step").on("click", function() {
            $('#smartwizard').smartWizard("stepState", [], "disable");
        });

        // https://stackoverflow.com/a/25414784
        function findFirstChildByClass(element, className) {
            var foundElement = null, found;
            function recurse(element, className, found) {
                for (var i = 0; i < element.childNodes.length && !found; i++) {
                    var el = element.childNodes[i];
                    var classes = el.className != undefined? el.className.split(" ") : [];
                    for (var j = 0, jl = classes.length; j < jl; j++) {
                        if (classes[j] == className) {
                            found = true;
                            foundElement = element.childNodes[i];
                            break;
                        }
                    }
                    if (found) {
                        break;
                    }
                    recurse(element.childNodes[i], className, found);
                }
            }
            recurse(element, className, false);
            return foundElement;
        }

        $("#mdl-add-step").on("click", function() {
            mdlWizardItemCount += 1;
            const stepper = document.getElementById("demo-stepper");

            // Create new step
            const step = stepper.children[0];
            const stepClone = step.cloneNode(true);
            stepClone.classList.remove("is-active");
            var newStepTitle = findFirstChildByClass(stepClone, "mdl-step__title-text");
            var newStepLabel = findFirstChildByClass(stepClone, "mdl-step__label-indicator-content");
            newStepTitle.textContent = "Title of step " + mdlWizardItemCount.toString();
            newStepLabel.textContent = mdlWizardItemCount.toString();

            // Replace old steps with identical copies of themselves to clear possible duplicate event listeners (thanks to how stepper.js is implemented)
            for (var i = 0; i < stepper.children.length; i++) {
                var child = stepper.children[i];
                child.replaceWith(child.cloneNode(true));
            }

            // Add the new step to the Stepper
            stepper.appendChild(stepClone);

            // Make sure the stepper is "upgraded" to wire up the new step correctly
            stepper.setAttribute('data-upgraded', '');
            componentHandler.upgradeElement(stepper);

            // Add 'onstepnext' event listeners to all the steps
            var stepperElement = document.querySelector('.mdl-stepper');
            var steps = stepperElement.querySelectorAll('.mdl-step');

            for (var i = 0; i < steps.length; i++) {
                steps[i].addEventListener('onstepnext', handleNextStep);
            }
        });
    </script>
  </body>
</html>